{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Tasks</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script src="{% static 'script.js' %}"></script>
</head>
<body>
<div class="container">
    <h2>Tasks</h2>

    <input type="text" id="title" placeholder="Task Title">
    <input type="text" id="description" placeholder="Task Description">
    <button onclick="createTask()">Create Task</button>

    <h3>Task List</h3>
    <div id="taskList"></div>
</div>

<script>
async function loadTasks() {
    const res = await authFetch(`${API_URL}/api/tasks/`);
    if (!res.ok) return alert("Failed to load tasks");

    const tasks = await res.json();
    const container = document.getElementById("taskList");
    container.innerHTML = "";

    tasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "task" + (task.is_completed ? " completed" : "");
        div.innerHTML = `
            <b>${task.title}</b> - ${task.description}
            <br>
            <button onclick="toggleComplete(${task.id}, ${task.is_completed})">Toggle Complete</button>
            <button onclick="deleteTask(${task.id})">Delete</button>
        `;
        container.appendChild(div);
    });
}

async function createTask() {
    const title = document.getElementById("title").value;
    const description = document.getElementById("description").value;

    const res = await authFetch(`${API_URL}/api/tasks/`, {
        method: "POST",
        body: JSON.stringify({ title, description, is_completed: false }),
    });

    if (res.ok) {
        document.getElementById("title").value = "";
        document.getElementById("description").value = "";
        loadTasks();
    } else {
        const err = await res.json();
        alert("Error creating task: " + JSON.stringify(err));
    }
}


async function toggleComplete(id, is_completed) {
    await authFetch(`${API_URL}/api/tasks/${id}/`, {
        method: "PATCH",
        body: JSON.stringify({ is_completed: !is_completed }),
    });
    loadTasks();
}





async function deleteTask(id) {
    await authFetch(`${API_URL}/api/tasks/${id}/`, { method: "DELETE" });
    loadTasks();
}

// Load tasks on page load
loadTasks();
</script>
</body>
</html>
